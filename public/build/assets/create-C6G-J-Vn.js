import{q as H,r as v,v as R,j as e,$ as E,m as F}from"./app-CuTFWHAe.js";import{C as $}from"./container-B8oyuVxK.js";import{d as i,D as k}from"./date-picker-Cy03XPKE.js";import{F as d}from"./form-control-Zf8vSzLy.js";import{H as w}from"./heading-small-y0dwTo1X.js";import{A as J,b as K}from"./avatar-QLOCQ9d7.js";import{B as n}from"./button-Cd7sFFRN.js";import{C as D,a as j,b as V,c as L,d as S,e as Q}from"./card-B1bjcNU7.js";import{I as G}from"./input-BwhpgtM2.js";import{S as O,a as U,b as W,c as X,d as y}from"./select-TK_vaCUB.js";import{T as Z,a as ee,b as Y,c,e as ae,d as u}from"./table-DiwHhOmL.js";import{T as te}from"./textarea-Ct8MG5pM.js";import{A as se}from"./app-layout-DtvwsQil.js";import{c as re,f as ie}from"./utils-BldNzIHX.js";import{t as h}from"./index-Cr4vvYJV.js";import{M as ne}from"./minus-BIQhG9Mw.js";import{P as oe}from"./plus-DfAPI9Qk.js";import{T as de}from"./trash-2-BtcNgUb8.js";/* empty css            */import"./chevron-right-BK8X6ucq.js";import"./createLucideIcon-CwLcMOID.js";import"./index-D9B_KDrM.js";import"./index-CagErs3-.js";import"./index-KWzzRgEU.js";import"./index-BhMOsRWa.js";import"./index-DIcONf7H.js";import"./index-Cybx4eJN.js";import"./index-BMyU5h93.js";import"./label-C_vIBvGw.js";import"./index-CFjP5EH2.js";import"./index-BdQq_4o_.js";import"./index-DyNF8MXF.js";import"./index-D1vV8S7h.js";import"./index-BdwKS5dj.js";import"./check-DtuR4GvH.js";import"./sheet-BPAHl7Ib.js";import"./x-CyKZPLTY.js";import"./app-logo-icon-DxqoCxNl.js";const le=[{title:"Peminjaman",href:"/pinjam"},{title:"Buat peminjaman",href:route("pinjam.create")}],Ge=({users:T,bukus:x})=>{var _;const{auth:{user:q}}=H().props,[b,o]=v.useState([]),[p,f]=v.useState(""),I=a=>{a.preventDefault();const t=x.find(s=>s.isbn===p);t?o(s=>{const C=s.findIndex(m=>m.buku_id===t.id);if(C!==-1){const m=[...s];return m[C].qty+=1,m}return[...s,{buku_id:t.id,qty:1}]}):h.error(`Buku ${p} tidak ditemukan`),f("")},M=a=>{o(t=>t.map(s=>s.buku_id===a?{...s,qty:s.qty+1}:s))},P=a=>{o(t=>t.map(s=>s.buku_id===a&&s.qty>1?{...s,qty:s.qty-1}:s))},A=a=>{o(t=>t.filter(s=>s.buku_id!==a))},g=i().format("YYYY-MM-DD"),{data:r,setData:l,errors:B,reset:N}=R({user_id:void 0,loan_date:g,note:"",due_date:i(g).add(7,"day").format("YYYY-MM-DD"),items:[]}),z=a=>{a.preventDefault(),F.post(route("pinjam.store"),{user_id:r.user_id,loan_date:r.loan_date,due_date:r.due_date,note:r.note,items:b.map(t=>({buku_id:t.buku_id,qty:t.qty}))},{preserveScroll:!0,onSuccess:()=>{h.success("Peminjaman berhasil dibuat"),N(),o([])},onError:t=>{h.error(ie(t))}})};return e.jsxs(se,{breadcrumbs:le,children:[e.jsx(E,{title:"Peminjaman"}),e.jsxs($,{title:"Form peminjaman",description:"Buat peminjaman baru",children:[e.jsxs(D,{children:[e.jsxs(j,{children:[e.jsx(V,{children:"Informasi peminjaman"}),e.jsx(L,{children:"isi dengan data yang sesuai"})]}),e.jsxs(S,{className:"grid grid-cols-4 gap-6",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(d,{label:"Pilih peminjam",children:e.jsxs(O,{value:(_=r.user_id)==null?void 0:_.toString(),onValueChange:a=>l("user_id",parseInt(a)),children:[e.jsx(U,{className:re("w-full",B.user_id&&"border-destructive"),children:e.jsx(W,{placeholder:"Pilih user"})}),e.jsxs(X,{children:[e.jsx(y,{value:"null",children:"Pilih peminjam"}),T.map(a=>e.jsxs(y,{value:a.id.toString(),children:[e.jsx(J,{className:"size-4",children:e.jsx(K,{src:a.avatar,alt:a.name})}),a.name]},a.id))]})]})})}),e.jsx(d,{label:"Tanggal pinjam",children:e.jsx(k,{date:i(r.loan_date).toDate(),onDateChange:a=>l("loan_date",i(a).format("YYYY-MM-DD"))})}),e.jsx(d,{label:"Rencana pengembalian",children:e.jsx(k,{date:i(r.due_date).toDate(),onDateChange:a=>l("due_date",i(a).format("YYYY-MM-DD"))})}),e.jsx("div",{className:"col-span-4",children:e.jsx(d,{label:"Catatan tambahan",children:e.jsx(te,{placeholder:"Keterangan tambahan, misalkan kondisi buku sebelum dipinjam dll",value:r.note,onChange:a=>l("note",a.target.value)})})})]}),e.jsx(Q,{children:e.jsxs(n,{variant:"ghost",disabled:!0,children:["Petugas input: ",q.name]})})]}),e.jsxs(D,{children:[e.jsx(j,{children:e.jsx(w,{title:"Item yang dipinjam",description:"tanggal pinjam dan tanggal kembali"})}),e.jsx(j,{children:e.jsx("form",{onSubmit:I,children:e.jsx(d,{label:"Scan disini",children:e.jsx(G,{placeholder:"Scan barcode atau QR code buku",value:p,onChange:a=>f(a.target.value)})})})}),e.jsx(S,{children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(Y,{children:[e.jsx(c,{children:"Kode buku"}),e.jsx(c,{children:"Judul buku"}),e.jsx(c,{children:"Jumlah"}),e.jsx(c,{children:"Action"})]})}),e.jsx(ae,{children:b.map(a=>{const t=x.find(s=>s.id===a.buku_id);return e.jsxs(Y,{children:[e.jsx(u,{children:t==null?void 0:t.isbn}),e.jsx(u,{children:t==null?void 0:t.title}),e.jsx(u,{children:e.jsxs("div",{className:"flex",children:[e.jsx(n,{size:"icon",variant:"outline",onClick:()=>P(a.buku_id),children:e.jsx(ne,{})}),e.jsx(n,{size:"icon",variant:"ghost",children:a.qty}),e.jsx(n,{size:"icon",variant:"outline",onClick:()=>M(a.buku_id),children:e.jsx(oe,{})})]})}),e.jsx(u,{children:e.jsx(n,{size:"icon",variant:"ghost",onClick:()=>A(a.buku_id),children:e.jsx(de,{})})})]},a.buku_id)})})]})})]}),e.jsx("form",{onSubmit:z,children:e.jsx(n,{type:"submit",children:"simpan"})})]})]})};export{Ge as default};
